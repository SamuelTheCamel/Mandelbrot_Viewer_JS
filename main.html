<!DOCTYPE html>
<html lang="en-US">

<!-- JavaScript Mandelbrot Viewer and Fractal Viewer by Samuel Voltz -->

<head>

<title> Mandelbrot Viewer </title>

<style>
body {font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align:center}
h1, h2, h3 {font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;}
</style>

<script src="mandelbrot.js"></script>

</head>

<body>

<h1> Mandelbrot Viewer </h1>

<canvas id="viewer" style="width:480px; height:360px; border:1px solid black" width="480" height="360"></canvas>

<hr>

<div>
    <p id="status"> Click "Refresh" to see the fractal with your desired settings. </p>
    <button id="refresh_button"> Refresh </button>
</div>

<script>
    
    // initialize canvas
    const canvas = document.getElementById("viewer");
    const context = canvas.getContext("2d");
    let parameters;

    let controller;

    async function refreshCanvas() {
        /*
        Draws the fractal with the user-specified properties on the canvas.
        Does a fast draw first with faster parameters.
        */

        // abort function if currently running
        if (controller) {
            controller.abort();
        }

        // allow function to be aborted
        controller = new AbortController();
        const signal = controller.signal;

        parameters ??= new DrawParameters();

        let fast_parameters = {...parameters}; // create shallow copy of parameters
        fast_parameters.pixel_size = 6;
        fast_parameters.max_iter = 100;

        await drawFractal(canvas, context, fast_parameters, signal);
        await drawFractal(canvas, context, parameters, signal);
    }

    document.getElementById("refresh_button").addEventListener("click", refreshCanvas);

</script>

</body>